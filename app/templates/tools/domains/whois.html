<!-- app/templates/tools/dmains/whois.html -->
 
{% extends "base.html" %}

{% block title %}{{title}}{% endblock %}


{% block content %}


<style>
    .results-table {
        margin-top: 20px;
    }

    .results-table th,
    .results-table td {
        text-align: left;
        padding: 10px;
    }

    .results-table th {
        background-color: #f8f9fa;
    }

    .results-table td {
        background-color: #fff;
    }

    .duration {
        font-style: italic;
    }

    #duration-chart-container {
        max-width: 400px;
        /* Adjusted the maximum width */
        margin: 20px auto;
    }

    #duration-chart {
        width: 100% !important;
        height: auto !important;
    }

    .status-icon {
        font-size: 2rem;
    }

    .status-icon.valid {
        color: green;
    }

    .status-icon.invalid {
        color: red;
    }
</style>
<div class="container content"> <!-- mt-5 -->
    <h2  class="mb-3">{{title}} <i class="bi bi-info-circle info-icon" data-bs-toggle="modal" data-bs-target="#infoModal"></i></h2>
    <p  class="mb-3">{{ definition }}</p>

    <div class="alert alert-info" role="alert">
        <p class="mb-0">{{ definition }}</p>
    </div>

    <div class="row mb-3">
        <div class="col-md-3">
            <form method="POST">
                {{ form.hidden_tag() }}
                <div class="form-group">
                    {{ form.domain.label }}
                    {{ form.domain(class="form-control") }}
                    {% for error in form.domain.errors %}
                    <small class="form-text text-danger">{{ error }}</small>
                    {% endfor %}
                </div>
                <!-- <button type="submit" class="btn btn-primary"></button> -->
            </form>
        </div>
        <div class="col-md-3 d-flex align-items-end">
            <button type="submit" class="btn btn-primary w-100">Enviar</button>
        </div>
    </div>

    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card border-info">
                <div class="card-body text-center">
                    <div class="card-icon text-info"><i class="fas fa-stopwatch"></i></div>
                    <h5 class="card-title">First Contentful Paint (FCP)</h5>
                    <p class="card-text">2.1 seconds</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-warning">
                <div class="card-body text-center">
                    <div class="card-icon text-warning"><i class="fas fa-image"></i></div>
                    <h5 class="card-title">Largest Contentful Paint (LCP)</h5>
                    <p class="card-text">2.94 seconds</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-danger">
                <div class="card-body text-center">
                    <div class="card-icon text-danger"><i class="fas fa-hand-pointer"></i></div>
                    <h5 class="card-title">First Input Delay (FID)</h5>
                    <p class="card-text">553 milliseconds</p>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-primary">
                <div class="card-body text-center">
                    <div class="card-icon text-primary"><i class="fas fa-ruler-combined"></i></div>
                    <h5 class="card-title">Cumulative Layout Shift (CLS)</h5>
                    <p class="card-text">0.7813</p>
                </div>
            </div>
        </div>
    </div>

    <hr>
    {% if results %}
    <h3>Resultados de {{ title }}:</h3>
    <div class="row">
        <div class="col-md-6">
            <p class="duration">Duración del scan: {{ duration }} segundos</p>
            <div id="duration-chart-container">
                <canvas id="duration-chart"></canvas>
            </div>
        </div>
        <div class="col-md-6 text-center">
            {% if is_results_valid %}
            <i class="fas fa-check-circle status-icon valid"></i>
            <p class="text-success">Resultados válidos</p>
            {% else %}
            <i class="fas fa-exclamation-circle status-icon invalid"></i>
            <p class="text-danger">Resultados no válidos</p>
            {% endif %}
        </div>
    </div>
    {% if is_results_valid %}
    <table class="table table-striped table-bordered results-table">
        <thead>
            <tr>
                <th>Campo</th>
                <th>Valor</th>
            </tr>
        </thead>
        <tbody>
            {% for key, value in results['whois_lookup'].items() %}
            {% if value %}
            <tr>
                <th>{{ key | replace("_", " ") | title }}</th>
                <td>
                    {% if value is string %}
                    {{ value }}
                    {% elif value is iterable and not value is string %}
                    <ul>
                        {% for item in value %}
                        <li>{{ item }}</li>
                        {% endfor %}
                    </ul>
                    {% else %}
                    {{ value }}
                    {% endif %}
                </td>
            </tr>
            {% endif %}
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <p>No se encontraron resultados válidos.</p>
    {% endif %}
    {% endif %}
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        var ctx = document.getElementById('duration-chart').getContext('2d');
        var chart = new Chart(ctx, {
            type: 'bar',
            data: {
                labels: ['Duración del scan'],
                datasets: [{
                    label: 'Tiempo (segundos)',
                    data: [{{ duration }}],
                backgroundColor: 'rgba(75, 192, 192, 0.2)',
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 1
            }]
        },
            options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
            });
        });
</script>
</div>
{% endblock %}